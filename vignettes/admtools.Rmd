---
title: "admtools: Getting Started"
output: rmarkdown::html_vignette
author: "Niklas Hohmann"
vignette: >
  %\VignetteIndexEntry{admtools: Getting Started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, echo=FALSE}
library(admtools)
```

# Introduction

This vignette is an introduction to the _admtools_ package.

## Installation

The package can be installed from _GitHub_ or _CRAN_. Generally, the package deposited from CRAN will be the latest stable release, while the package on GitHub will be the version under development.

### From GitHub

To install the latest version of the package directly from _GitHub_, first install the devtools package if you have not done so yet:

```{r, eval=FALSE}
install.packages("devtools")

```

Then run

```{r, eval=FALSE}
devtools::install_github(repo = "MindTheGap-ERC/admtools",
                         build_vignettes = TRUE)
```

to install the package and build its vignettes.

### From CRAN

To install the package from CRAN, run

```{r, eval=FALSE}
install.packages("admtools")
```

## Loading the package

Load the package using

```{r}
library(admtools)
```

This makes all functions in the package available.

## The adm and multiadm classes

The _admtools_ package defines two main classes: `adm` and `multiadm`. The class `adm` represent a single age-depth model, from which information can be extracted (e.g. completeness, number of hiatuses, etc.) and that can be used to transform data between the stratigraphic domain and time domain. The `multiamd` class is a portfolio of `adm` object used to represent uncertainties of age-depth models.

## Conventions

In contrast to its name, the _admtools_ package currently deals with time and height instead of age and depth. In this sense, the age-depth models are time-height models. To model ages and depths, use time before present and height below some point of reference.

## Example

This example exmplains the  construction and application of `adm` objects. As example data we use outputs from CarboCAT Lite, a model of carbonate platform growth (Burgess 2013, 2023). This data is automatically loaded in the background by the package. To inspect it, you can load it into your workspace via

```{r}
data("CarboCATLite_data")
```

## Defining age-depth models

The standard constructor for age-depth models is _tp_2_adm_ ("tiepoint to age-depth model"). It returns an _adm_ object. This object combines information of stratigraphic heights and times and erosive interval. It allows to transform data between the stratigraphic and the time domain, and identify which data is destroyed due to hiatuses.
We use the timing and stratigraphic positions of tie points taken from CarboCAT Lite to construct an age-depth model. , and use the option to directly associate length and time units with it.

```{R}
# see ?tp_2_adm for detailed documentation
my_adm = tp_2_adm(t = CarboCATLite_data$time_myr,
                  h = CarboCATLite_data$height_2_km_offshore_m,
                  L_unit = "m",
                  T_unit = "Myr")
```

Typing `adm` in the console will only tell that the generated variable is an age-depth model

```{r}
my_adm
```
To get some a quick overview of the properties of `my_adm`, use _summary_:
```{R}
summary(my_adm)
```

If you want to inspect the insides of the object, use _str_:

```{r}
str(my_adm)
```

To get a visual representation, we plot it, and highlight hiatuses in red

```{R}
# see ?plot.adm for plotting options for adm objects
plot(my_adm,
     col_hiat = "red",
     lwd_cons = 3)
```


Use the functions _get_total_duration_, _get_total_thickness_, _get_completeness_, and _get_hiat_no_ extract information directly from the age-depth model:

```{r}
get_total_duration(my_adm) #total time covered by the age-depth model
get_total_thickness(my_adm) # total thickness of section represented by the amd
get_completeness(my_adm) # stratigraphic completeness as proportion
get_incompleteness(my_adm) # stratigraphic incompleteness (= 1- strat. incompleteness)
get_hiat_no(my_adm) # number of hiatuses
```


The function _is_destructive_ can be used to examine whether time points coincide with hiatuses:

```{R}
is_destructive(adm = my_adm,
               t = c(0.1,0.5)) 
```

## Transforming data between time and stratigraphic domain

The functions _get_height_ and _get_time_ are the workhorses to transform data using age-depth models.

* _get_time_ takes and adm object and vector of heights _h_  (stratigraphic positions), and returns a vector of times
* _get_height_ takes an adm object and vector of times and returns a vector of associated positions

As example, say we want to know the time of deposition of the following stratigraphic positions:

```{r}
h = c(30,120) # stratigraphic positions
get_time(adm = my_adm,
             h = h)
```
Conversely, to determine what parts of the section are deposited as a specific time, use
```{r}
t = c(0.2,1.4)
get_height(adm = my_adm,
           t = t)
```
Here, the _NA_ indicates that the time 1.4 coincides with erosion. If you want to know the stratigraphic position of the hiatus that coincides with that time, use the option _destructive = FALSE_:

```{r}
t = c(0.2,1.4)
get_height(adm = my_adm,
           t = t,
           destructive = FALSE)
```
## Further information

For information on estimating age-depth models from sedimentation rates, see
```{r, eval=FALSE}
vignette("adm_from_sedrate")
```

For information on estimating age-depth models from tracer contents of rocks and sediments, see
```{r, eval=FALSE}
vignette("adm_from_trace_cont")
```
 

## References
* Burgess, Peter. "CarboCAT: A cellular automata model of heterogeneous carbonate strata." Computers & geosciences 53 (2013): 129-140. [DOI: 10.1016/j.cageo.2011.08.026](https://doi.org/10.1016/j.cageo.2011.08.026)
* Burgess, Peter. "CarboCAT Lite v1.0.1". Zenodo 2023. [DOI: 10.5281/zenodo.8402578](https://doi.org/10.5281/zenodo.8402578)
