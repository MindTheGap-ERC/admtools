---
title: "sed_content"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{sed_content}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(admtools)
```

# Estimating age-depth models from stratigraphic contents

### Coding tie points

Timing and height of tie points are coded via the functions t_tp (timing of tie points) and h_tp (height of tie points) that take no inputs. They serve as wrappers around user-defined procedures that reflect uncertainties around tie points. Every time t_tp and h_tp are evaluated, they return possible values for the tie points. Writing these functions requires some effort, but it allows the user to hand over arbitrarily complex uncertainties of the tie points to the strat_cont_to_multiadm function.

The function for the heights of the tie points must return a named vector with entries "h1" and "h2", corresponding to the heights of the first (lower) and second (upper) tie point. "h1" must be smaller than "h2".

For this example, I assume the stratigraphic positions of the tie points known without uncertainty, and are at 10 and 20 m stratigraphic height.

```{r}
h_min = 10 # stratigraphic height of lower tie point [m]
h_max = 20 # stratigraphic height of upper tie point [m]
```

*h_tp* is then implemented as follows:

```{r}
h_tp = function(){
  return(c("h1" = h_min,
           "h2" = h_max))
}
```

When evaluated, this function returns the stratigraphic positions of the tie points:

```{r}
#Evaluate stratigraphic positions of tie points
h_tp()
```

The function for the timing of the tie points must return a named vector with names "t1" (timing of first tie point) and "t2" (timing of second tie point). "t1" must be smaller than "t2".

Similarly, tie points in time must return a named vector with names "t1" and "t2"

```{r}
t_tp = function() return(c("t1" = rnorm(n = 1, mean = 0, sd = 0.01), "t2" = runif(n = 1, min = 9, max = 11)))
```

```{r, echo=FALSE, fig.show="hold", out.width="50%"}
no_of_samples = 1000
hist(sapply( seq_len(no_of_samples), function(x) t_tp()["t1"]),
     freq = FALSE,
     xlab = "Time [Myr]",
     main = "Timing of lower tie point")
hist(sapply(seq_len(no_of_samples), function(x) t_tp()["t2"]),
     freq = FALSE,
     xlab = "Time [Myr]",
     main = "Timing of upper tie point")
```

### Coding Stratigraphic Data

Both stratigraphic contents and time contents must be coded as function factories, i.e., functions that return functions.

```{r}
time_cont_gen = function(){
  strat_cont = function(x) return(rep(1, length(x)))
  return(strat_cont)
}


```

```{r}
strat_cont_gen = function(){
   return(approxfun(x = c(0,0.5,1), y = c(10,1,8), yleft = 10, yright = 2))
}
```

Age-depth models can be estimated using the function strat_cont_to_multiadm:

```{r}
my_adm = strat_cont_to_multiadm(h_tp = h_tp,
                                t_tp = t_tp,
                                strat_cont_gen = strat_cont_gen,
                                time_cont_gen = time_cont_gen,
                                h = seq(0,1,by = 0.1),
                                no_of_rep = 100)
```

```{r}
plot(my_adm)
```
